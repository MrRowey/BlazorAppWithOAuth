@page "/unit-caculators/shield"

<h3>Shield Caculator</h3>

<EditForm Model="@shieldData" OnValidSubmit="HandleValidSubmit" class="shield-form-condensed">
    <DataAnnotationsValidator />
    <ValidationSummary class="validation-summary" />

    <!-- Description Section -->
    <h3>Description</h3>
    <div class="form-row description">
        <div class="form-group">
            <label for="UnitName">Unit Name:</label>
            <InputText id="UnitName" @bind-Value="shieldData.UnitName" class="form-control" />
        </div>
        <div class="form-group">
            <label for="UnitID">Unit ID:</label>
            <InputText id="UnitID" @bind-Value="shieldData.UnitID" class="form-control" />
        </div>
    </div>

    <!-- Base Stats Section -->
    <h3>Base Stats</h3>
    <div class="form-row">
        <div class="form-group">
            <label for="Health">Health:</label>
            <InputNumber id="Health" @bind-Value="shieldData.Health" class="form-control" />
        </div>
        <div class="form-group">
            <label for="MassCost">Mass Cost:</label>
            <InputNumber id="MassCost" @bind-Value="shieldData.MassCost" class="form-control" />
        </div>
        <div class="form-group">
            <label for="EnergyCost">Energy Cost:</label>
            <InputNumber id="EnergyCost" @bind-Value="shieldData.EnergyCost" class="form-control" />
        </div>
        <div class="form-group">
            <label for="BuildTime">Build Time:</label>
            <InputNumber id="BuildTime" @bind-Value="shieldData.BuildTime" class="form-control" />
        </div>
    </div>

    <!-- Shield Stats Section -->
    <h3>Shield Stats</h3>
    <div class="form-row">
        <div class="form-group">
            <label for="ShieldHealth">Health:</label>
            <InputNumber id="ShieldHealth" @bind-Value="shieldData.ShieldHealth" class="form-control" />
        </div>
        <div class="form-group">
            <label for="ShieldRegen">Regen:</label>
            <InputNumber id="ShieldRegen" @bind-Value="shieldData.ShieldRegen" class="form-control" />
        </div>
        <div class="form-group">
            <label for="ShieldSize">Size:</label>
            <InputNumber id="ShieldSize" @bind-Value="shieldData.ShieldSize" class="form-control" />
        </div>
        <div class="form-group">
            <label for="ShieldRechargeTime">Recharge Time:</label>
            <InputNumber id="ShieldRechargeTime" @bind-Value="shieldData.ShieldRechargeTime" class="form-control" />
        </div>
    </div>

    <!-- Economy Section -->
    <h3>Economy</h3>
    <div class="form-row">
        <div class="form-group">
            <label for="BuildRate">Build Rate:</label>
            <InputNumber id="BuildRate" @bind-Value="shieldData.BuildRate" class="form-control" />
        </div>
        <div class="form-group">
            <label for="EnergyDrain">Energy Drain:</label>
            <InputNumber id="EnergyDrain" @bind-Value="shieldData.EnergyDrain" class="form-control" />
        </div>
    </div>

    <!-- Intel Section -->
    <h3>Intel</h3>
    <div class="form-row">
        <div class="form-group full-width">
            <label for="VisionRadius">Vision Radius:</label>
            <InputNumber id="VisionRadius" @bind-Value="shieldData.VisionRadius" class="form-control" />
        </div>
    </div>

    <!-- Submit Button -->
    <button type="submit" class="btn-submit">Input Data</button>
</EditForm>

<!-- Condensed Styling Section -->
<style>
    .shield-form-condensed {
        max-width: 1000px;
        margin: 0 auto 20px;
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 8px;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
    }

    h3 {
        margin: 10px 0;
        font-size: 1.2em;
        color: #333;
        border-bottom: 1px solid #007bff;
        padding-bottom: 3px;
        text-align: center;
    }

    .form-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
    }

    .form-group {
        flex: 1 1 22%;
        text-align: center;
        margin: 0 5px;
    }

        .form-group.full-width {
            flex: 1 1 100%;
            margin: 0 5px;
        }

        .form-group label {
            display: block;
            margin-bottom: 2px;
            font-weight: bold;
            font-size: 0.9em;
            color: #333;
        }

    .form-control {
        width: 100%;
        padding: 5px;
        font-size: 0.9em;
        border: 1px solid #ccc;
        border-radius: 4px;
        transition: border-color 0.3s;
    }

        .form-control:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 3px rgba(0, 123, 255, 0.5);
        }

    .btn-submit {
        display: block;
        width: 100%;
        padding: 8px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
        transition: background-color 0.3s;
        margin-top: 10px;
    }

        .btn-submit:hover {
            background-color: #0056b3;
        }
</style>


@if (shieldList.Count > 0)
{
    <table>
        <thead>
            <tr>
                <th></th> <!-- Empty for column headers -->
                @foreach (var shield in shieldList)
                {
                    <th>@shield.UnitID</th>
                }
            </tr>
        </thead>
        <tbody>
            <tr>
                <th>Unit ID</th>
                @foreach (var shield in shieldList)
                {
                    <td>@shield.UnitID</td>
                }
            </tr>
            <tr>
                <th>Health</th>
                @for (int i = 0; i < shieldList.Count; i++)
                {
                    <td>
                        @shieldList[i].Health
                        @if (i > 0)
                        {
                            <span>(@PercentageChange(shieldList[i].Health, shieldList[i - 1].Health)%)</span>
                        }
                    </td>
                }
            </tr>
            <tr>
                <th>Mass Cost</th>
                @for (int i = 0; i < shieldList.Count; i++)
                {
                    <td>
                        @shieldList[i].MassCost
                        @if (i > 0)
                        {
                            <span>(@PercentageChange(shieldList[i].MassCost, shieldList[i - 1].MassCost)%)</span>
                        }
                    </td>
                }
            </tr>
            <tr>
                <th>Energy Cost</th>
                @for (int i = 0; i < shieldList.Count; i++)
                {
                    <td>
                        @shieldList[i].EnergyCost
                        @if (i > 0)
                        {
                            <span>(@PercentageChange(shieldList[i].EnergyCost, shieldList[i - 1].EnergyCost)%)</span>
                        }
                    </td>
                }
            </tr>
            <tr>
                <th>Build Time</th>
                @for (int i = 0; i < shieldList.Count; i++)
                {
                    <td>
                        @shieldList[i].BuildTime
                        @if (i > 0)
                        {
                            <span>(@PercentageChange(shieldList[i].BuildTime, shieldList[i - 1].BuildTime)%)</span>
                        }
                    </td>
                }
            </tr>
            <tr>
                <th>Shield Health</th>
                @for (int i = 0; i < shieldList.Count; i++)
                {
                    <td>
                        @shieldList[i].ShieldHealth
                        @if (i > 0)
                        {
                            <span>(@PercentageChange(shieldList[i].ShieldHealth, shieldList[i - 1].ShieldHealth)%)</span>
                        }
                    </td>
                }
            </tr>
            <tr>
                <th>Shield Regen</th>
                @for (int i = 0; i < shieldList.Count; i++)
                {
                    <td>
                        @shieldList[i].ShieldRegen
                        @if (i > 0)
                        {
                            <span>(@PercentageChange(shieldList[i].ShieldRegen, shieldList[i - 1].ShieldRegen)%)</span>
                        }
                    </td>
                }
            </tr>
            <tr>
                <th>Shield Size</th>
                @for (int i = 0; i < shieldList.Count; i++)
                {
                    <td>
                        @shieldList[i].ShieldSize
                        @if (i > 0)
                        {
                            <span>(@PercentageChange(shieldList[i].ShieldSize, shieldList[i - 1].ShieldSize)%)</span>
                        }
                    </td>
                }
            </tr>
            <tr>
                <th>Shield Recharge Time</th>
                @for (int i = 0; i < shieldList.Count; i++)
                {
                    <td>
                        @shieldList[i].ShieldRechargeTime
                        @if (i > 0)
                        {
                            <span>(@PercentageChange(shieldList[i].ShieldRechargeTime, shieldList[i - 1].ShieldRechargeTime)%)</span>
                        }
                    </td>
                }
            </tr>
            <tr>
                <th>Build Rate</th>
                @for (int i = 0; i < shieldList.Count; i++)
                {
                    <td>
                        @shieldList[i].BuildRate
                        @if (i > 0)
                        {
                            <span>(@PercentageChange(shieldList[i].BuildRate, shieldList[i - 1].BuildRate)%)</span>
                        }
                    </td>
                }
            </tr>
            <tr>
                <th>Energy Drain</th>
                @for (int i = 0; i < shieldList.Count; i++)
                {
                    <td>
                        @shieldList[i].EnergyDrain
                        @if (i > 0)
                        {
                            <span>(@PercentageChange(shieldList[i].EnergyDrain, shieldList[i - 1].EnergyDrain)%)</span>
                        }
                    </td>
                }
            </tr>
            <tr>
                <th>Vision Radius</th>
                @for (int i = 0; i < shieldList.Count; i++)
                {
                    <td>
                        @shieldList[i].VisionRadius
                        @if (i > 0)
                        {
                            <span>(@PercentageChange(shieldList[i].VisionRadius, shieldList[i - 1].VisionRadius)%)</span>
                        }
                    </td>
                }
            </tr>
            <!-- Row for Delete Buttons -->
            <tr>
                <th>Delete Unit</th> <!-- Empty header for delete row -->
                @foreach (var shield in shieldList)
                {
                    <td> 
                        <button @onclick="() => DeleteShield(shield)">Delete</button>
                    </td>
                }
            </tr>
        </tbody>
    </table>
}

<style>
    table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        font-size: 1em;
        font-family: Arial, sans-serif;
    }

    thead th {
        background-color: #f2f2f2;
        font-weight: bold;
        padding: 10px;
        border-bottom: 2px solid #ddd;
        text-align: left;
    }

    tbody th {
        text-align: left;
        background-color: #f9f9f9;
        padding: 10px;
        border-bottom: 1px solid #ddd;
    }

    tbody td {
        padding: 10px;
        border-bottom: 1px solid #ddd;
    }

    tbody tr:nth-child(even) {
        background-color: #f2f2f2;
    }

    tbody tr:hover {
        background-color: #e9e9e9;
    }
</style>

@code {
    // A List to Store Mutiple Shield Data
    private List<FormData> shieldList = new List<FormData>();

    // Model to hold the new shield data input by the user
    private FormData shieldData = new FormData();

    private void HandleValidSubmit()
    {

        // Add the new shield Data to the lsit
        shieldList.Add(new FormData
            {
                UnitID = shieldData.UnitID,
                Health = shieldData.Health,
                MassCost = shieldData.MassCost,
                EnergyCost = shieldData.EnergyCost,
                BuildTime = shieldData.BuildTime,
                ShieldHealth = shieldData.ShieldHealth,
                ShieldRegen = shieldData.ShieldRegen,
                ShieldSize = shieldData.ShieldSize,
                ShieldRechargeTime = shieldData.ShieldRechargeTime,
                BuildRate = shieldData.BuildRate,
                EnergyDrain = shieldData.EnergyDrain,
                VisionRadius = shieldData.VisionRadius
            });

        // Reset the form for the next shield data input
        shieldData = new FormData();
    }

    // Caculate the Percetage Chnage between two values
    private double PercentageChange(int currentValue, int previousValue)
    {
        if(previousValue == 0) return 0; // Avoid divide by zero
        return Math.Round(((double)(currentValue - previousValue) / previousValue) * 100, 2);
    }

    // Method to delete shield by index
    private void DeleteShield(FormData shield)
    {
        shieldList.Remove(shield);
    }

    public class FormData
    {
        public string UnitName { get; set; }
        public string UnitID { get; set; }
        public int Health { get; set; }
        public int MassCost { get; set; }
        public int EnergyCost { get; set; }
        public int BuildTime { get; set; }
        public int ShieldHealth { get; set; }
        public int ShieldRegen { get; set; }
        public int ShieldSize { get; set; }
        public int ShieldRechargeTime { get; set; }
        public int BuildRate { get; set; }
        public int EnergyDrain { get; set; }
        public int VisionRadius { get; set; }     
    }
}
